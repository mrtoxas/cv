---
import Section from "../ui/Section.astro";
import SkillList from "../ui/SkillList.astro";

import type { CollectionEntry } from "astro:content";

type Props = CollectionEntry<"main">["data"]["portfolio"];

const { title, list } = Astro.props;

const images = await Astro.glob("/src/assets/images/portfolio/*.png");

const getImg = (imgKey:string) => images.filter(item => item.default.src.includes(imgKey));
---

<Section title={title}>
  <div class="grid gap-y-12">
    {list.map((item, index) => (
      <div>
        <div>
          <h3 class="inline font-bold print:print:text-sm whitespace-nowrap uppercase">{item.name}</h3> â€“ <p class="inline">{item.description}</p>
        </div>
        <div class="mt-2 print:mt-0">
          <div class="mt-1">
            <SkillList skills={item.techList} />
          </div>
        </div>
        {item.imgKey && (
          <div class="pswp-gallery mt-6 flex gap-2 overflow-x-auto md:overflow-visible md:flex-wrap">
            {getImg(item.imgKey).map(imgItem => (
              <a class="border border-border shrink-0 hidden first:inline"
               data-fancybox={`gallery-${index}`}
               href={imgItem.default.src}
               data-width={imgItem.default.width}
               data-height={imgItem.default.height}
               target="_blank">
                  <div class="flex bg-background items-center justify-center w-52 aspect-video relative after:content-[''] after:-z-1 after:bg-backplate after:absolute after:bottom-2 after:left-2 after:w-full after:h-full after:border-1 after:border-border">
                      <img
                        src={`./portfolio-screens/${item.imgKey}-preview.png`}
                        alt={`${item.name} preview`}
                        class="block h-full w-full object-cover"
                        decoding="async"
                        loading="lazy"
                      />
                  </div>
              </a>
            ))}
          </div>
        )}
        <div class="mt-3 flex gap-2">
          {item.links.map((linkItem) => (
            <a target="_blank" class="inline-flex items-center text-sm gap-x-0.5 underline-offset-4 hover:text-primary hover:underline" href={linkItem.link}>
              <span class="i-lucide:link w-1em h-1em"></span>{linkItem.name}
            </a>
          ))}
        </div>
      </div>
    )
  )}</div>
</Section>

<script>
  import { Fancybox } from "@fancyapps/ui";
  import "@fancyapps/ui/dist/fancybox/fancybox.css";

  document.addEventListener('astro:page-load', () => {
    Fancybox.bind("[data-fancybox]", {
      Hash: false,
      defaultType: "image",
      Slideshow: false,
    });
  })
  
</script>